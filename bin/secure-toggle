#!/bin/bash
# Use PGP to lock and unlock files private files

# Preliminaries:
#   inst gpa seahorse

# Pack the directory
if [ -d "$1" ]
then
    echo "Packing the directory ($1)"
    echo "Zip"
    zip -r "$1" "$1"
    # Clean up the directory
    if [ -f "$1.zip" ]; then mv $1 /tmp/priv$$; fi

    # Pack the file
    if [ -f "$1.zip" ]
    then
        echo 'Encrypt for mark.seaman@shrinking-world.com'
        gpg --encrypt "$1.zip"

        # Clean up the zip file
        if [ -f "$1.zip.gpg" ]; then mv "$1.zip" /tmp/privzip$$; fi
    else
        echo "Could not find file, $1"
    fi
else
    echo "Unpacking the directory ($1.zip.gpg)"
    if [ -f "$1.zip.gpg" ]
    then
        gpg --decrypt $1.zip.gpg > $1.zip
        if [ -f "$1.zip" ]
        then
            echo "Unzip the directory ($1.zip)"
            unzip "$1.zip"
            echo "Remove the archive files"
            if [ -d $1 ]
            then 
                mv $1.zip /tmp/privzip$$
                mv $1.zip.gpg /tmp/priv$$
            fi
            echo "File tree"
            tree $1
        else
            echo "Could not find file, $2.zip"
        fi
    else
        echo "Could not find file, $2.zip.gpg"
    fi
fi
