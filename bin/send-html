#!/usr/bin/python
# Send an email message using the STMP server at seaman@comsystem.us

from smtplib            import SMTP
from email.mime.multipart import MIMEMultipart
from email.mime.text    import MIMEText
from sys                import stdin,argv

my_smtp     = 'smtp.webfaction.com'
my_user     = 'seaman'
my_password = 'mds959WF'
my_to       = ['mark.b.seaman@gmail.com']
my_from     = 'mark@seamanfamily.org'
my_subject  = 'Message from Mark Seaman'

# Alternative rendering of text
def plain_text():
    return "Terribly sorry, but there is no plain text message available."

# Create the envelope to hold the message
def create_envelope(from_addr, to_addrs, subject):
    msg = MIMEMultipart('alternative')
    msg['Subject'] = subject
    msg['From'] = from_addr
    msg['To'] = to_addrs[0]
    return msg

# Record the MIME types of both parts - text/plain and text/html.
def create_message(msg, text, html):
    msg.attach (MIMEText (text, 'plain'))
    msg.attach (MIMEText (html, 'html')) # Default format

# Send the email that was created through SMTP
def send_message(smtp,user,password,from_addr, to_addrs, msg):     # Send the message
    s = SMTP(smtp)
    s.login(user,password)
    s.sendmail(from_addr, to_addrs, msg.as_string())
    s.quit()

# Send a email in HTML and text
def send_email(from_addr, to_addrs, subject, text, html):
    msg = create_envelope(from_addr, to_addrs, subject)
    create_message (msg, text, html)
    send_message(my_smtp,my_user,my_password,from_addr, to_addrs, msg) 

# Set the "To" addresses
to_addrs = my_to
if (len(argv) > 1):
   to_addrs = argv[1].split(',')

# Set the "Subject" addresses
if (len(argv) > 2):
   my_subject = argv[2]

# Send the message
text = stdin.read()
send_email(my_from, to_addrs, my_subject, plain_text(), text)


